# Scrapper - Распределённая система мониторинга ссылок

## Обзор

Scrapper — это распределённое приложение для отслеживания веб-ресурсов и уведомления пользователей через Telegram. Система состоит из двух основных микросервисов:

- **Telegram Bot** - Обрабатывает команды пользователей и отправляет уведомления
- **Scrapper Service** - Мониторит изменения на отслеживаемых ресурсах

Сервисы взаимодействуют через HTTP и используют отдельные базы данных PostgreSQL.

## Основные возможности

- **Отслеживание ссылок**: Добавление URL через команды Telegram-бота
- **Обнаружение изменений**: Периодическая проверка ресурсов на обновления
- **Мгновенные уведомления**: Отправка алертов в Telegram при изменениях
- **Хранение данных**: Использование PostgreSQL с persistent-томами Docker
- **Масштабируемость**: Контейнерная архитектура позволяет легко масштабировать компоненты

## Стек технологий

- **Бэкенд**: Java/Spring Boot (bot.jar и scrapper.jar)
- **База данных**: PostgreSQL (отдельные БД для каждого сервиса)
- **Контейнеризация**: Docker с оркестрацией через Docker Compose
- **Сеть**: Пользовательская bridge-сеть для взаимодействия контейнеров

## Быстрый старт

### Требования

- Docker Engine (версия 20.10.0 или выше)
- Docker Compose (версия 1.29.0 или выше)
- Аккаунт Telegram (для работы с ботом)

### Установка

1. Клонируйте репозиторий
2. Создайте файл `.env` на основе шаблона
3. Соберите и запустите контейнеры:

```bash
docker-compose up --build -d
```

### Конфигурация

Все настройки задаются через файл `.env`. Ключевые параметры:

- Данные для доступа к БД (POSTGRES_USER, POSTGRES_PASSWORD)
- Токен Telegram-бота (TELEGRAM_BOT_TOKEN)
- Порты сервисов (BOT_SERVER_PORT, SCRAPPER_SERVER_PORT)
- URL подключения к БД (BOT_DATASOURCE_URL, SCRAPPER_DATASOURCE_URL)

## Архитектура системы

```
[ Пользователь Telegram ]
       │
       ▼
[ Telegram Bot ] (HTTP :8080)
       │ ▲
       │ └─── Уведомления
       ▼
[ Scrapper Service ] (HTTP :8081)
       │
       ▼
[ База данных PostgreSQL ]
```

## Документация API

После запуска доступна Swagger-документация:

- API бота: `http://localhost:8080/swagger-ui/index.html`
- API scrapper: `http://localhost:8081/swagger-ui/index.html`

## Использование

Основные команды для работы с ботом:

- `/start` - Начать работу
- `/track <URL>` - Добавить URL для отслеживания
- `/list` - Показать все отслеживаемые ссылки
- `/untrack <URL>` - Удалить URL из отслеживания
- `/search <тег>` - Поиск ссылок по тегу

## Мониторинг и обслуживание

### Основные команды

Просмотр контейнеров:
```bash
docker-compose ps
```

Просмотр логов:
```bash
docker-compose logs -f [имя_сервиса]
```

Доступ к БД:
```bash
docker exec -it postgres_db psql -U [пользователь] -d [имя_бд]
```

### Сохранение данных

Данные БД сохраняются между перезапусками благодаря Docker-томам.

## Решение проблем

Частые проблемы и решения:

1. **Ошибки соединения между сервисами**:
   - Проверьте, что контейнеры в одной сети
   - Убедитесь в правильности hostname в переменных окружения

2. **Проблемы с инициализацией БД**:
   - Проверьте права на исполнение init-скриптов
   - Убедитесь в правильности учётных данных в .env

3. **Конфликты портов**:
   - Измените маппинг портов в docker-compose.yml
   - Проверьте занятость портов на хосте
